{% extends 'main/base_projects.html' %}

{% load static %}

{% block content %}

    {% block extracss %}
        <link type='text/css' rel="stylesheet" href="{% static 'viewmodel/css/fire_prog.css' %}"/>
        <!-- Leaflet -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
            integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
            crossorigin=""
        />
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin="">
        </script>
    {% endblock %}



    <form id="georreferencingForm" action="./progression" method="POST">
    {% if frame is not None %}
        <div hidden>
            {{ georreferencing.marker }}
            {{ georreferencing.pixels }}
            {{ georreferencing.geo }}
            {{ georreferencing.frame_id }}
            {{ georreferencing.polygon_wkt }}
        </div>
        {% csrf_token %}
        <div id="img_prog"  style="display: flex; padding-top: 20vh; justify-content: center; align-items: center; ">
        {% if segmented %}
            <div hidden id="polygon_georreferenced">
            {{ segmented }}>
            </div>
            <img hidden draggable="false" id="WorkingImage" src={{ frame.content.url }}>
        {% else %}
            <img hidden draggable="false" id="workingImage" src={{ frame.content.url }}>
        {% endif %}
        </div>
    {% endif %}
    </form>

	<div class="toolkit">
		<table>
			<caption id="caption">Toolkit<a id= "cp" title="Close Toolkit"><i id="close" class="fas fa-times"></i></a></caption>
			<tbody id="toolkit">
			<tr>
				<td id="showImage"><i class="fas fa-image fa-lg"></i></td>
				<td id="zoomIn"><i class="fas fa-search-plus fa-lg"></i></td>
			</tr>
			<tr>
				<td id="marker" onclick="markerOn()"><i class="fas fa-map-marker-alt fa-lg"></i></td>
				<td id="zoomOut"><i class="fas fa-search-minus fa-lg"></i></td>
			</tr>
			<tr>
                <td id="play_tk" onclick="openMap()" style="cursor: pointer;"><i class="fas fa-play fa-lg"></i></td>
                <td onclick="saveCoords()"><i class="fas fa-save fa-lg" aria-hidden="true"></i></td>
			</tr>
			<tr>
				<td id="stack"><i class="fas fa-layer-group fa-lg" aria-hidden="true"></i></td>
				<!-- <td onClick="openUpload()"><a ><i class="fa fa-folder-open fa-lg" aria-hidden="true"></i></td> -->
                <td id="undo"><a ><i class="fa fa-undo" aria-hidden="true"></i></td>
			</tr>
			<tr>
				<td><i class="fas fa-expand-arrows-alt fa-lg" aria-hidden="true"></i></td>
				<td id="help"><i class="fa fa-question-circle fa-lg" aria-hidden="true"></i></td>
			</tr>
		</tbody>
		</table>
	</div>
    <div class="pixel_table">
        <table hidden id="pixel_table_coords">
            <tr id="head_Of_Coord_Table">
                <td>
                    Pixel coords
                </td>
                <td>
                    Geo Coords
                </td>
            </tr>
        </table>
    </div>
    
	<div hidden class="upload" id="upload">
		<h1>Upload Files</h1>
		<p>If you have the polygon coordinates, or the file that contains them, please use this tool in order to see how the fire evolved:</p>
		<form id="UploadCoordFile" style="overflow: hidden; padding: 0.1em 0 0 1em;" method="POST" action="{% url 'upload_polygon' project.id %}" enctype="multipart/form-data">
            <div hidden>
                {{ file_form.image_id }}
            </div>
                {% csrf_token %}
                {{ file_form.coords }}
                <button type="button" id="file-upload__button" class="button icon solid fa-download">Choose File</button>
                <span class="file-upload__label"></span>
                <input type="button" id="submit_pol" value="Upload Coords">
			</form>
        <button class="button icon solid" type="button" value="Draw" name="drawPolygonButton" id="drawPolygonButton" onclick="drawMap()">DRAW </button><br>
	</div>

    <div class="col-12" id="animationButtons" hidden>
        <button type="button" class="button icon solid" name="drawPolygonButton" id="drawPolygonButton">Play Animation</button>
        <button type="button" class="button icon solid" name="stopDraw" id="stopDraw"/>Stop Animation</button><br>
    </div>
    <br>

	<!-- TODO see the best way to view the progression -->
    <span hidden id="span_frameid"> {{ frame.id }}</span>
	<div id="map" style="height: 750px;" hidden>

    </div>

    <div id="popUpGEO">
        <small>Geographic Coordinates: lat, lon</small>
        <br>
        <input id='coordinates' type='text' name='coordinates' class='form-control'>
        <br>
        <button class='btn btn-default'id='submit'> SAVE! </button>
    </div>

    <img src="https://upload.wikimedia.org/wikipedia/commons/f/f2/678111-map-marker-512.png" id="georef_marker" style="display: none; position: absolute; width: 50px; height: 50px;" />

    {% block extrajs %}
        <!-- This is necessary for the popUp -->
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
        <!--
            <script src="{% static 'viewmodel/js/map.js' %}"></script>
        -->
    <script src="{% static 'viewmodel/js/fire_prog.js' %}"></script>

    <!-- TODO: Move this script into viewmodel once it's finished -->
    <script>
        
   
    </script>
    {% endblock %}



{% endblock %}